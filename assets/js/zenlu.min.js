(()=>{document.addEventListener("DOMContentLoaded",()=>{let h=document.querySelector("#blog-content");if(!h)return;let k=document.querySelector("z-bibliography[src]"),g=document.querySelector("z-appendix");if(!k||!g)return;let y=g.querySelector("z-footnote"),E=g.querySelector("z-citation-list");if(!y||!E)return;let S=k.getAttribute("src"),v=h.querySelectorAll("z-fn[key]"),m=[];if(v.forEach(e=>{let l=e.getAttribute("key"),o=e.innerHTML.trim();m.push({key:l,text:o})}),v.forEach((e,l)=>{let o=document.createElement("sup");o.className="footnote cursor-pointer text-blue-600 dark:text-blue-400 hover:text-blue-500 dark:hover:text-blue-300 transition-colors",o.setAttribute("data-fn-index",l),o.textContent="\u2020",e.replaceWith(o)}),m.length>0){let e=document.createElement("h3");e.textContent="Footnotes",e.className="footnotes-heading",y.appendChild(e),e.id="footnotes",m.forEach((l,o)=>{let t=document.createElement("div");t.className="footnote-item";let i=document.createElement("span");i.className="footnote-label",i.textContent=o+1+".";let a=document.createElement("p");a.innerHTML=l.text,t.appendChild(i),t.appendChild(a),y.appendChild(t)})}let w=h.querySelectorAll("z-cite[key]"),p=[];w.forEach(e=>{e.getAttribute("key").split(",").map(t=>t.trim()).filter(t=>t).forEach(t=>{p.includes(t)||p.push(t)})}),w.forEach(e=>{let o=e.getAttribute("key").split(",").map(s=>s.trim()).filter(s=>s),t=o.map(s=>p.indexOf(s)+1).sort((s,r)=>s-r),i="";if(t.length===1)i=`[${t[0]}]`;else{let s=[],r=t[0],n=r;for(let c=1;c<t.length;c++){let d=t[c];d===n+1||(r===n?s.push(r.toString()):s.push(`${r}\u2013${n}`),r=d),n=d}r===n?s.push(r.toString()):s.push(`${r}\u2013${n}`),i="["+s.join(",")+"]"}let a=document.createElement("sup");a.className="citation cursor-pointer text-blue-600 hover:text-blue-500 dark:text-blue-400 dark:hover:text-blue-300 transition-colors",a.setAttribute("data-cite-keys",o.join(",")),a.textContent=i,e.replaceWith(a)}),fetch(S).then(e=>e.text()).then(e=>{let l=$(e),o=p.map(n=>l.find(c=>c.key===n)).filter(Boolean);if(o.length>0){let n=document.createElement("h3");n.textContent="References",n.className="references-heading",E.appendChild(n),n.id="references",o.forEach((c,d)=>{let u=document.createElement("div");u.className="reference-item";let f=document.createElement("span");f.className="reference-label",f.textContent="["+(d+1)+"]";let b=document.createElement("div");b.className="reference-content",b.innerHTML=C(c),u.appendChild(f),u.appendChild(b),E.appendChild(u)})}let t=document.createElement("div");t.className="citation-tooltip",t.style.display="none",t.style.position="absolute",t.style.zIndex="9999",document.body.appendChild(t);let i=!1,a=!1;function s(n,c){t.innerHTML=n,t.style.display="block",x(c,t)}function r(){!i&&!a&&(t.style.display="none")}t.addEventListener("mouseenter",()=>{i=!0}),t.addEventListener("mouseleave",()=>{i=!1,setTimeout(r,100)}),document.querySelectorAll("sup.citation").forEach(n=>{let d=n.getAttribute("data-cite-keys").split(",").map(u=>u.trim()).map(u=>{let f=p.indexOf(u);return f===-1?null:{index:f+1,ref:o[f]}}).filter(Boolean);n.addEventListener("mouseenter",()=>{a=!0;let u=d.map(f=>`<div class="citation-tooltip-item">
              <div class="citation-tooltip-ref">${C(f.ref)}</div>
            </div>`).join("");s(u,n)}),n.addEventListener("mousemove",()=>{x(n,t)}),n.addEventListener("mouseleave",()=>{a=!1,setTimeout(r,100)})}),document.querySelectorAll("sup.footnote").forEach(n=>{let c=parseInt(n.getAttribute("data-fn-index"),10),d=m[c];d&&(n.addEventListener("mouseenter",()=>{a=!0,s(`<div class="citation-tooltip-ref">${d.text}</div>`,n)}),n.addEventListener("mousemove",()=>{x(n,t)}),n.addEventListener("mouseleave",()=>{a=!1,setTimeout(r,100)}))})}).catch(e=>console.error("Error loading bibliography:",e)),h.querySelectorAll("h1, h2, h3, h4, h5, h6").forEach(e=>{let l=e.nextElementSibling;l&&l.tagName==="Z-BYLINE"&&(e.tagName.toLowerCase()==="h1"?l.classList.add("z-byline-fullwidth"):e.tagName.toLowerCase()==="h2"&&l.classList.add("z-byline-framework"))});function x(e,l){let o=e.getBoundingClientRect(),t=l.getBoundingClientRect(),i=window.scrollY||window.pageYOffset,a=window.scrollX||window.pageXOffset,s=12,r=i+o.top-t.height-s,n=a+o.left+o.width/2-t.width/2;n<s&&(n=s),n+t.width>window.innerWidth&&(n=window.innerWidth-t.width-s),r<i&&(r=i+o.bottom+s),l.style.top=`${r}px`,l.style.left=`${n}px`}function C(e){let l=[],o="";e.title&&(o+=`<span class="ref-title">${e.title}</span>`);let t=[];e.pdf&&t.push(`<a href="${e.pdf}" target="_blank" rel="noopener" class="ref-inline-extras a">[pdf]</a>`),e.url&&t.push(`<a href="${e.url}" target="_blank" rel="noopener" class="ref-inline-extras a">[link]</a>`),t.length>0&&(o+=` <span class="ref-inline-extras">${t.join(" ")}</span>`),o&&l.push(o);let i=[];e.authors&&i.push(e.authors),e.year&&i.push(`(${e.year})`);let a=e.journal||e.booktitle||e.publisher||"";return a&&i.push(a),e.volume&&i.push(e.volume),e.pages&&i.push(e.pages),e.doi&&i.push(`doi:${e.doi}`),i.length>0&&l.push(`<span class="ref-details">${i.join(" ")}</span>`),l.join("<br>")}function $(e){let l=e.split("@").slice(1),o=[];return l.forEach(t=>{t=t.trim();let i=t.match(/^(\w+)\s*\{([^,]+),/i);if(!i)return;let a=i[2].trim(),s=t.lastIndexOf("}"),r=t.substring(t.indexOf("{")+1,s),n=N(r);o.push({key:a,authors:n.author||"",title:n.title||"",year:n.year||"",journal:n.journal||"",booktitle:n.booktitle||"",publisher:n.publisher||"",volume:n.volume||"",pages:n.pages||"",doi:n.doi||"",url:n.url||"",pdf:n.pdf||"",html:n.html||""})}),o}function N(e){let l=e.split(`
`),o={},t=null,i="";return l.forEach(a=>{let s=a.trim();if(s==="")return;let r=s.indexOf("=");if(r>-1){t&&(o[t.toLowerCase()]=L(i),t=null,i="");let n=s.slice(0,r).trim().toLowerCase(),c=s.slice(r+1).trim();t=n,i=c}else t&&(i+=" "+s)}),t&&(o[t.toLowerCase()]=L(i)),o}function L(e){return e=e.trim(),e=e.replace(/^[{"]+|[}"]+$/g,""),e=e.replace(/[},]+$/g,""),e=e.replace(/}|\.$/g,""),e.trim()}});})();
