// z-components.scss
// Ensure Tailwind and variables are available before this file
// Example: @tailwind base; @tailwind components; @tailwind utilities;

$serif-font: "Merriweather", Georgia, serif;

// Math & Equations
.math-content {
  .MathJax {
    @apply my-1 leading-tight;
  }

  .math-display {
    @apply my-6 py-4 overflow-x-auto text-center relative group;
    .MathJax_ref {
      @apply absolute right-0 top-1/2 -translate-y-1/2 text-gray-500 dark:text-gray-400;
    }
  }

  .theorem {
    @apply my-6 p-4 rounded-lg bg-blue-50 dark:bg-blue-900/30 border-l-4 border-blue-500;
    .theorem-title {
      @apply font-bold mb-2;
    }
  }

  .proof {
    @apply my-6 p-4 rounded-lg bg-gray-50 dark:bg-gray-900/50 border-l-4 border-gray-500;
    &::after {
      content: "â–¡";
      @apply float-right;
    }
  }

  .matrix {
    @apply my-2;
    .MathJax {
      @apply tracking-widest;
    }
  }

  .eqref {
    @apply cursor-pointer text-blue-600 dark:text-blue-400 hover:underline;
  }
}

// z-equation components
z-equation {
  @apply relative block my-8 overflow-x-auto;
  
  &[display] {
    @apply text-center py-6;
    &::after {
      content: '(' attr(number) ')';
      @apply absolute right-0 top-1/2 -translate-y-1/2 text-gray-500 dark:text-gray-400;
    }
  }

  &[align] {
    display: grid;
    grid-template-columns: auto 1fr auto;
    gap: 1rem;
  }
}

.dark .MathJax {
  @apply text-gray-100;
}

.dark .math-display {
  @apply bg-gray-900/30;
}

// z-footnote
z-footnote {
  @apply text-sm text-gray-500 mb-2;
  &::before {
    content: attr(number) '.';
    @apply mr-2 text-gray-400;
  }
}

// z-cite
z-cite {
  @apply inline-flex items-center text-blue-600 cursor-help relative hover:text-blue-800;
  &::before {
    content: '[' attr(number) ']';
    @apply text-sm;
  }
  .citation-preview {
    @apply absolute z-50 bg-white p-4 rounded-lg shadow-xl border border-gray-200 text-sm text-gray-700 max-w-md;
    animation: fadeIn 0.2s ease-out;
  }
}

// z-bibliography
z-bibliography {
  @apply space-y-4 text-sm text-gray-600;
}

z-bib {
  @apply pl-8 -indent-8;
}

// z-ref if needed for references
z-ref {
  @apply pl-8 -indent-8 text-sm text-gray-600;
}

// z-toc
.z-toc {
  @apply sticky top-8 max-h-[calc(100vh-4rem)] overflow-y-auto p-4 rounded-lg border border-gray-200 dark:border-gray-700 bg-white dark:bg-gray-800;
  .toc-header {
    @apply flex items-center justify-between mb-4 text-sm font-medium text-gray-900 dark:text-gray-100;
  }
  .toc-list {
    @apply space-y-1;
    &.root {
      @apply mt-0;
    }
    .toc-list {
      @apply mt-1 ml-4 hidden;
      &.expanded {
        @apply block;
      }
    }
  }
  .toc-item {
    @apply relative;
    &.has-children > .toc-link::after {
      content: '';
      @apply absolute right-2 top-1/2 -translate-y-1/2 w-2 h-2 border-r border-b border-gray-400 dark:border-gray-500 transform rotate-45 transition-transform;
    }
    &.expanded > .toc-link::after {
      @apply rotate-[225deg];
    }
  }
  .toc-link {
    @apply block py-1 px-2 rounded text-sm text-gray-600 dark:text-gray-400 hover:bg-gray-50 dark:hover:bg-gray-700/50 transition-colors relative;
    &.active {
      @apply text-blue-600 dark:text-blue-400 bg-blue-50 dark:bg-blue-900/30 font-medium;
    }
    &[data-level="1"] {
      @apply pl-4;
    }
    &[data-level="2"] {
      @apply pl-6;
    }
  }
}

// Code blocks (z-code)
z-code {
  @apply relative -mx-12 my-8 overflow-hidden rounded-lg border border-gray-200;

  .header {
    @apply px-4 py-2 bg-gray-50 border-b border-gray-200 flex justify-between items-center;
  }

  .line-numbers {
    @apply text-gray-400 pr-4 select-none border-r border-gray-200 text-right;
  }

  .content {
    @apply p-4 pl-4 font-mono text-gray-800 overflow-x-auto;
  }
  
  .copy-btn {
    @apply text-sm text-gray-500 hover:text-gray-800 flex items-center gap-1;
  }
}

@keyframes fadeIn {
  from { opacity: 0 }
  to { opacity: 1 }
}
