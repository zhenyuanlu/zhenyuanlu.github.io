<!-- Load MathJax first if needed -->
<script async src="https://cdn.jsdelivr.net/npm/mathjax@3/es5/tex-chtml-full.js"></script>

<!-- Load Alpine.js -->
<script src="{{ '/assets/js/alpine.min.js' | relative_url }}"></script>

<!-- Load Lucide Icons after Alpine -->
<script src="https://unpkg.com/lucide@latest/dist/umd/lucide.js"></script>

<!-- Load custom scripts -->
<script src="{{ '/assets/js/filter-blog.min.js' | relative_url }}"></script>
<script src="{{ '/assets/js/toc.min.js' | relative_url }}"></script>
<script src="{{ '/assets/js/zenlu.min.js' | relative_url }}"></script>
<script src="{{ '/assets/js/misc.min.js' | relative_url }}"></script>

<script>
// Initialize everything after DOM is loaded
document.addEventListener('DOMContentLoaded', function() {
  // Initialize Alpine.js if not already done
  if (window.Alpine && !window.Alpine.started) {
    window.Alpine.start();
  }
  
  // Initialize Lucide icons
  if (window.lucide) {
    lucide.createIcons();
  }
  
  // Re-initialize icons after any dynamic content changes
  const observer = new MutationObserver(function(mutations) {
    let shouldUpdate = false;
    mutations.forEach(function(mutation) {
      if (mutation.type === 'childList' && mutation.addedNodes.length > 0) {
        shouldUpdate = true;
      }
    });
    
    if (shouldUpdate && window.lucide) {
      setTimeout(() => lucide.createIcons(), 100);
    }
  });
  
  observer.observe(document.body, {
    childList: true,
    subtree: true
  });
});

// Also initialize after Alpine is ready
document.addEventListener('alpine:initialized', function() {
  if (window.lucide) {
    lucide.createIcons();
  }
});

// Handle page transitions and dynamic content
window.addEventListener('beforeunload', function() {
  if (observer) {
    observer.disconnect();
  }
});
</script>