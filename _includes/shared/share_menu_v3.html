<!-- Share Dropdown Component -->
<div class="relative">
    <!-- Share Button Trigger -->
    <button 
      onclick="toggleShareMenu(event)"
      class="inline-flex items-center gap-2 px-4 py-2 rounded-lg bg-gray-100 hover:bg-gray-200 dark:bg-gray-800 dark:hover:bg-gray-700 transition-colors"
    >
      <i class="fa-solid fa-share-nodes w-4 h-4"></i>
      <span class="text-sm">Share</span>
    </button>
  
    <!-- Dropdown Menu -->
    <div 
      id="shareMenu"
      class="absolute right-0 mt-2 w-56 rounded-lg overflow-hidden bg-white dark:bg-gray-900 shadow-lg ring-1 ring-black/5 dark:ring-white/10 z-50 opacity-0 -translate-y-2 invisible transition-all duration-200"
      onclick="event.stopPropagation()"
    >
      <!-- Menu Header -->
      <div class="px-4 py-3 border-b border-gray-200 dark:border-gray-800">
        <h3 class="text-sm font-medium text-gray-700 dark:text-gray-300">Share via</h3>
      </div>
  
      <!-- Share Options -->
      <div class="py-2">
        <!-- Twitter -->
        <a 
          href="https://twitter.com/share?url={{ page.url | absolute_url }}"
          target="_blank"
          rel="noopener noreferrer"
          class="flex items-center gap-3 px-4 py-2.5 text-sm text-gray-700 dark:text-gray-300 hover:bg-gray-100 dark:hover:bg-gray-800 transition-colors"
        >
          <i class="fa-brands fa-x-twitter w-4 h-4"></i>
          <span>Twitter</span>
          <i class="fa-solid fa-external-link w-3 h-3 ml-auto opacity-50"></i>
        </a>
  
        <!-- Facebook -->
        <a 
          href="https://www.facebook.com/sharer/sharer.php?u={{ page.url | absolute_url }}"
          target="_blank"
          rel="noopener noreferrer"
          class="flex items-center gap-3 px-4 py-2.5 text-sm text-gray-700 dark:text-gray-300 hover:bg-gray-100 dark:hover:bg-gray-800 transition-colors"
        >
          <i class="fa-brands fa-facebook w-4 h-4"></i>
          <span>Facebook</span>
          <i class="fa-solid fa-external-link w-3 h-3 ml-auto opacity-50"></i>
        </a>
  
        <!-- LinkedIn -->
        <a 
          href="https://www.linkedin.com/sharing/share-offsite/?url={{ page.url | absolute_url }}"
          target="_blank"
          rel="noopener noreferrer"
          class="flex items-center gap-3 px-4 py-2.5 text-sm text-gray-700 dark:text-gray-300 hover:bg-gray-100 dark:hover:bg-gray-800 transition-colors"
        >
          <i class="fa-brands fa-linkedin w-4 h-4"></i>
          <span>LinkedIn</span>
          <i class="fa-solid fa-external-link w-3 h-3 ml-auto opacity-50"></i>
        </a>
  
        <!-- WeChat -->
        <button 
          onclick="toggleWeChatQR()"
          class="w-full flex items-center gap-3 px-4 py-2.5 text-sm text-gray-700 dark:text-gray-300 hover:bg-gray-100 dark:hover:bg-gray-800 transition-colors"
        >
          <i class="fa-brands fa-weixin w-4 h-4"></i>
          <span>WeChat</span>
        </button>
  
        <!-- WeChat QR Section -->
        <div id="wechatQR" class="hidden px-4 py-3 border-t border-gray-200 dark:border-gray-800">
          <div class="bg-white p-3 rounded-lg w-fit mx-auto">
            <div id="qrCode"></div>
          </div>
          <p class="text-xs text-center text-gray-500 dark:text-gray-400 mt-2">
            Scan with WeChat to share
          </p>
        </div>
  
        <!-- Divider -->
        <div class="h-px bg-gray-200 dark:bg-gray-800 my-2"></div>
  
        <!-- Copy Link -->
        <button
          id="copyButton"
          onclick="copyShareLink()"
          class="w-full flex items-center gap-3 px-4 py-2.5 text-sm text-gray-700 dark:text-gray-300 hover:bg-gray-100 dark:hover:bg-gray-800 transition-colors"
        >
          <i class="fa-solid fa-copy w-4 h-4"></i>
          <span>Copy link</span>
        </button>
      </div>
    </div>
  </div>
  
  <script src="https://cdnjs.cloudflare.com/ajax/libs/qrcodejs/1.0.0/qrcode.min.js"></script>
  
  <script>
    function toggleShareMenu(event) {
      event.stopPropagation();
      const menu = document.getElementById('shareMenu');
      const isHidden = menu.classList.contains('invisible');
      
      if (isHidden) {
        menu.classList.remove('invisible', 'opacity-0', '-translate-y-2');
        document.addEventListener('click', closeShareMenu);
      } else {
        closeShareMenu();
      }
    }
  
    function closeShareMenu() {
      const menu = document.getElementById('shareMenu');
      menu.classList.add('invisible', 'opacity-0', '-translate-y-2');
      document.removeEventListener('click', closeShareMenu);
      
      // Reset WeChat section
      const wechatSection = document.getElementById('wechatQR');
      wechatSection.classList.add('hidden');
    }
  
    function toggleWeChatQR() {
      const qrSection = document.getElementById('wechatQR');
      const isHidden = qrSection.classList.contains('hidden');
      
      if (isHidden) {
        qrSection.classList.remove('hidden');
        
        // Generate QR code
        const qrContainer = document.getElementById('qrCode');
        qrContainer.innerHTML = '';
        new QRCode(qrContainer, {
          text: window.location.href,
          width: 120,
          height: 120,
          colorDark: "#000000",
          colorLight: "#ffffff",
          correctLevel: QRCode.CorrectLevel.H
        });
      } else {
        qrSection.classList.add('hidden');
      }
    }
  
    function copyShareLink() {
      navigator.clipboard.writeText(window.location.href).then(() => {
        const button = document.getElementById('copyButton');
        const originalContent = button.innerHTML;
        button.innerHTML = `
          <i class="fa-solid fa-check w-4 h-4 text-green-600"></i>
          <span>Copied!</span>
        `;
        setTimeout(() => {
          button.innerHTML = originalContent;
        }, 2000);
      });
    }
  
    // Add keyboard support
    document.addEventListener('keydown', (event) => {
      if (event.key === 'Escape') {
        closeShareMenu();
      }
    });
  
    // Add native share if supported
    if (navigator.share) {
      const shareOptions = document.querySelector('.py-2');
      const nativeShareButton = document.createElement('button');
      nativeShareButton.className = 'w-full flex items-center gap-3 px-4 py-2.5 text-sm text-gray-700 dark:text-gray-300 hover:bg-gray-100 dark:hover:bg-gray-800 transition-colors';
      nativeShareButton.innerHTML = `
        <i class="fa-solid fa-share-nodes w-4 h-4"></i>
        <span>More options</span>
      `;
      nativeShareButton.onclick = () => {
        navigator.share({
          title: '{{ page.title }}',
          text: '{{ page.description }}',
          url: window.location.href
        }).catch(err => {
          if (err.name !== 'AbortError') {
            console.error('Share failed:', err);
          }
        });
      };
      shareOptions.insertBefore(nativeShareButton, shareOptions.firstChild);
    }
  </script>